Updated some of the code, to make it more readable and overall cleaner, as the last version was a bit messy.
